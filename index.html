
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DebtPro Mobile</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.36.0",
    "mysql2/": "https://esm.sh/mysql2@^3.16.0/"
  }
}
</script>
    
    <style>
        * { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            -webkit-tap-highlight-color: transparent;
        }
        body { background-color: #f8fafc; margin: 0; overscroll-behavior-y: contain; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Users, Plus, Search, Edit3, LayoutDashboard, 
          X, Phone, Mail, DollarSign, Wallet, ArrowRight
        } from 'lucide-react';

        const API_BASE = 'https://clientesresgistro.onrender.com';

        const App = () => {
          const [customers, setCustomers] = useState([]);
          const [loading, setLoading] = useState(true);
          const [view, setView] = useState('dashboard');
          const [searchTerm, setSearchTerm] = useState('');
          const [modalOpen, setModalOpen] = useState(false);
          const [selectedCustomer, setSelectedCustomer] = useState(null);
          const [formData, setFormData] = useState({ name: '', email: '', phone: '', totalDebt: '' });

          const fetchCustomers = async () => {
            setLoading(true);
            try {
              const res = await fetch(`${API_BASE}/customers`);
              const data = await res.json();
              setCustomers(Array.isArray(data) ? data : []);
            } catch (err) {
              console.error("Erro API:", err);
            } finally {
              setLoading(false);
            }
          };

          useEffect(() => { fetchCustomers(); }, []);

          const stats = useMemo(() => {
            const total = customers.reduce((acc, c) => acc + Number(c.totalDebt || 0), 0);
            return { total, count: customers.length };
          }, [customers]);

          const filtered = customers.filter(c => 
            c.name?.toLowerCase().includes(searchTerm.toLowerCase())
          );

          const openModal = (customer = null) => {
            if (customer) {
              setSelectedCustomer(customer);
              setFormData({ 
                name: customer.name, 
                email: customer.email, 
                phone: customer.phone, 
                totalDebt: customer.totalDebt 
              });
            } else {
              setSelectedCustomer(null);
              setFormData({ name: '', email: '', phone: '', totalDebt: '' });
            }
            setModalOpen(true);
          };

          const handleSubmit = async (e) => {
            e.preventDefault();
            const method = selectedCustomer ? 'PUT' : 'POST';
            const url = selectedCustomer 
              ? `${API_BASE}/customers/${selectedCustomer.id}` 
              : `${API_BASE}/customers`;
            
            const payload = selectedCustomer 
              ? { ...formData } 
              : { ...formData, id: crypto.randomUUID() };

            try {
              const res = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              if (res.ok) {
                setModalOpen(false);
                fetchCustomers();
              }
            } catch (err) {
              alert("Erro ao salvar dados.");
            }
          };

          return (
            <div className="flex flex-col min-h-screen bg-slate-50 pb-20 md:pb-0">
              {/* Header Mobile & Desktop */}
              <header className="bg-white border-b border-slate-100 px-6 py-4 flex items-center justify-between sticky top-0 z-20 shadow-sm">
                <div className="flex items-center gap-2">
                  <div className="bg-indigo-600 p-1.5 rounded-lg text-white">
                    <Wallet size={20}/>
                  </div>
                  <h1 className="text-lg font-extrabold text-slate-800 tracking-tight">DebtPro</h1>
                </div>
                <button 
                  onClick={() => openModal()}
                  className="bg-indigo-600 text-white p-2 rounded-full shadow-lg active:scale-90 transition-transform"
                >
                  <Plus size={24}/>
                </button>
              </header>

              <div className="flex flex-1">
                {/* Sidebar - Desktop Only */}
                <nav className="hidden md:flex w-64 bg-white border-r border-slate-100 p-6 flex-col gap-2">
                  <button 
                    onClick={() => setView('dashboard')}
                    className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${view === 'dashboard' ? 'bg-indigo-50 text-indigo-600 font-bold' : 'text-slate-400 hover:bg-slate-50'}`}
                  >
                    <LayoutDashboard size={20}/> Dashboard
                  </button>
                  <button 
                    onClick={() => setView('customers')}
                    className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${view === 'customers' ? 'bg-indigo-50 text-indigo-600 font-bold' : 'text-slate-400 hover:bg-slate-50'}`}
                  >
                    <Users size={20}/> Clientes
                  </button>
                </nav>

                {/* Main Content */}
                <main className="flex-1 p-5 md:p-8 overflow-y-auto animate-slide-up">
                  {view === 'dashboard' ? (
                    <div className="space-y-6">
                      {/* Stats Cards */}
                      <div className="grid grid-cols-1 gap-4">
                        <div className="bg-indigo-600 p-6 rounded-[2rem] text-white shadow-xl shadow-indigo-100">
                          <p className="text-indigo-100 text-xs font-bold uppercase tracking-widest opacity-80">Total em Aberto</p>
                          <h2 className="text-3xl font-black mt-1">
                            R$ {stats.total.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                          </h2>
                        </div>
                        <div className="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm flex items-center justify-between">
                          <div>
                            <p className="text-slate-400 text-xs font-bold uppercase tracking-widest">Clientes</p>
                            <h2 className="text-2xl font-black text-slate-800">{stats.count}</h2>
                          </div>
                          <div className="bg-slate-50 p-3 rounded-2xl text-slate-400">
                            <Users size={24}/>
                          </div>
                        </div>
                      </div>

                      {/* Recent Activity List */}
                      <div className="space-y-4">
                        <h3 className="font-bold text-slate-800 flex items-center justify-between px-1">
                          Mais Devedores
                          <span className="text-xs text-indigo-600" onClick={() => setView('customers')}>Ver todos</span>
                        </h3>
                        {loading ? (
                          <div className="flex justify-center py-10"><div className="w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"></div></div>
                        ) : (
                          <div className="space-y-3">
                            {customers.slice(0, 4).map(c => (
                              <div key={c.id} onClick={() => openModal(c)} className="bg-white p-4 rounded-2xl flex items-center justify-between border border-slate-50 shadow-sm active:bg-slate-50">
                                <div className="flex items-center gap-3">
                                  <div className="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center font-bold text-slate-500 uppercase">
                                    {c.name.charAt(0)}
                                  </div>
                                  <div>
                                    <p className="font-bold text-slate-700 text-sm">{c.name}</p>
                                    <p className="text-[10px] text-slate-400">{c.phone || 'Sem fone'}</p>
                                  </div>
                                </div>
                                <div className="text-right">
                                  <p className="text-sm font-black text-rose-500">R$ {Number(c.totalDebt).toFixed(2)}</p>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>
                  ) : (
                    <div className="space-y-4 pb-10">
                      <div className="relative">
                        <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" size={18}/>
                        <input 
                          placeholder="Buscar cliente..."
                          className="w-full pl-12 pr-4 py-4 bg-white border border-slate-100 rounded-2xl shadow-sm outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                          value={searchTerm}
                          onChange={e => setSearchTerm(e.target.value)}
                        />
                      </div>
                      
                      <div className="space-y-3">
                        {filtered.map(c => (
                          <div key={c.id} onClick={() => openModal(c)} className="bg-white p-5 rounded-[1.5rem] border border-slate-100 shadow-sm active:scale-[0.98] transition-transform">
                            <div className="flex justify-between items-start mb-3">
                              <h4 className="font-bold text-slate-800">{c.name}</h4>
                              <span className="bg-rose-50 text-rose-600 text-[10px] font-bold px-2 py-1 rounded-lg">Pendente</span>
                            </div>
                            <div className="flex items-center justify-between">
                              <div className="space-y-1">
                                <div className="flex items-center gap-2 text-xs text-slate-400"><Phone size={12}/> {c.phone}</div>
                                <div className="flex items-center gap-2 text-xs text-slate-400"><Mail size={12}/> {c.email}</div>
                              </div>
                              <div className="text-right">
                                <p className="text-lg font-black text-slate-800">R$ {Number(c.totalDebt).toFixed(2)}</p>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </main>
              </div>

              {/* Bottom Nav - Mobile Only */}
              <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 px-8 py-3 flex justify-around items-center safe-bottom z-30 shadow-[0_-4px_20px_rgba(0,0,0,0.03)]">
                <button 
                  onClick={() => setView('dashboard')}
                  className={`flex flex-col items-center gap-1 ${view === 'dashboard' ? 'text-indigo-600' : 'text-slate-300'}`}
                >
                  <LayoutDashboard size={24}/>
                  <span className="text-[10px] font-bold">Início</span>
                </button>
                <button 
                  onClick={() => setView('customers')}
                  className={`flex flex-col items-center gap-1 ${view === 'customers' ? 'text-indigo-600' : 'text-slate-300'}`}
                >
                  <Users size={24}/>
                  <span className="text-[10px] font-bold">Clientes</span>
                </button>
              </nav>

              {/* Modal Fullscreen-ish Mobile */}
              {modalOpen && (
                <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-end md:items-center justify-center z-50">
                  <div className="bg-white w-full max-w-lg rounded-t-[2.5rem] md:rounded-[2.5rem] p-8 md:p-10 shadow-2xl animate-slide-up relative max-h-[90vh] overflow-y-auto">
                    <div className="w-12 h-1.5 bg-slate-100 rounded-full mx-auto mb-6 md:hidden"></div>
                    <div className="flex justify-between items-center mb-8">
                      <h2 className="text-2xl font-black text-slate-800">
                        {selectedCustomer ? 'Editar Registro' : 'Novo Cadastro'}
                      </h2>
                      <button onClick={() => setModalOpen(false)} className="bg-slate-50 p-2 rounded-full text-slate-400">
                        <X size={20}/>
                      </button>
                    </div>

                    <form onSubmit={handleSubmit} className="space-y-6 pb-6">
                      <div className="space-y-1.5">
                        <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1">Nome Completo</label>
                        <input 
                          required
                          className="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none ring-2 ring-transparent focus:ring-indigo-500 transition-all text-sm font-medium"
                          value={formData.name}
                          onChange={e => setFormData({...formData, name: e.target.value})}
                        />
                      </div>
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1">Telefone</label>
                          <input 
                            className="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none ring-2 ring-transparent focus:ring-indigo-500 transition-all text-sm font-medium"
                            value={formData.phone}
                            onChange={e => setFormData({...formData, phone: e.target.value})}
                          />
                        </div>
                        <div className="space-y-1.5">
                          <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1">Dívida (R$)</label>
                          <input 
                            type="number" step="0.01"
                            className="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none ring-2 ring-transparent focus:ring-indigo-500 transition-all font-black text-rose-600 text-lg"
                            value={formData.totalDebt}
                            onChange={e => setFormData({...formData, totalDebt: e.target.value})}
                          />
                        </div>
                      </div>
                      <div className="space-y-1.5">
                        <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1">E-mail</label>
                        <input 
                          type="email"
                          className="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none ring-2 ring-transparent focus:ring-indigo-500 transition-all text-sm font-medium"
                          value={formData.email}
                          onChange={e => setFormData({...formData, email: e.target.value})}
                        />
                      </div>

                      <button 
                        type="submit"
                        className="w-full py-5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-2xl shadow-xl shadow-indigo-100 active:scale-[0.98] transition-all text-base"
                      >
                        {selectedCustomer ? 'Salvar Alterações' : 'Concluir Cadastro'}
                      </button>
                    </form>
                  </div>
                </div>
              )}
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
